<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard - WhatsBenemax</title>
  <link rel="stylesheet" href="/css/app.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<div class="app-container">

  <!-- Sidebar -->
  <aside class="app-sidebar" id="sidebar">
    <div class="sidebar-logo">
      <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
      </svg>
      <span>WhatsBenemax Admin</span>
    </div>

    <nav class="sidebar-menu">
      <a href="/admin/dashboard.html" class="menu-item active">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path>
        </svg>
        <span>Dashboard</span>
      </a>

      <a href="/admin/empresas.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
        </svg>
        <span>Empresas</span>
      </a>

      <a href="/admin/usuarios.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
        </svg>
        <span>Usu√°rios</span>
      </a>

      <a href="/admin/planos.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <span>Planos</span>
      </a>

      <a href="/admin/financeiro.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>Financeiro</span>
      </a>

      <a href="/admin/afiliados.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"></path>
        </svg>
        <span>Afiliados</span>
      </a>

      <a href="/admin/instancias.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
        </svg>
        <span>Inst√¢ncias WhatsApp</span>
      </a>

      <a href="/admin/crm.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
        </svg>
        <span>CRM</span>
      </a>

      <a href="/admin/agentes-ia.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
        </svg>
        <span>Agentes IA</span>
      </a>

      <a href="/admin/followup.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span>Follow-up</span>
      </a>

      <a href="/admin/prospeccao.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <span>Prospec√ß√£o</span>
      </a>

      <a href="/admin/whitelabel.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path>
        </svg>
        <span>White Label</span>
      </a>

      <a href="/admin/integracoes.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 4a2 2 0 114 0v1a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-1a2 2 0 100 4h1a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-1a2 2 0 10-4 0v1a1 1 0 01-1 1H7a1 1 0 01-1-1v-3a1 1 0 00-1-1H4a2 2 0 110-4h1a1 1 0 001-1V7a1 1 0 011-1h3a1 1 0 001-1V4z"></path>
        </svg>
        <span>Integra√ß√µes</span>
      </a>

      <a href="/admin/logs.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
        </svg>
        <span>Logs & Auditoria</span>
      </a>

      <a href="/admin/configuracoes.html" class="menu-item">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
        </svg>
        <span>Configura√ß√µes</span>
      </a>
    </nav>
  </aside>

  <!-- Header -->
  <header class="app-header">
    <button onclick="toggleSidebar()" class="header-btn">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
      </svg>
    </button>

    <div class="header-actions">
      <!-- Dark Mode Toggle -->
      <button class="header-btn" onclick="toggleDarkMode()" title="Alternar modo escuro">
        <svg class="w-6 h-6 dark-mode-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
        </svg>
      </button>

      <!-- Notifica√ß√µes -->
      <div class="relative">
        <button class="header-btn relative" onclick="toggleNotifications()" title="Notifica√ß√µes">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
          </svg>
          <span class="absolute top-0 right-0 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-red-600 rounded-full">3</span>
        </button>

        <!-- Dropdown de Notifica√ß√µes -->
        <div id="notificationsDropdown" class="dropdown-menu" style="display: none; right: 0; left: auto; min-width: 320px;">
          <div class="p-4 border-b border-gray-200 dark:border-gray-700">
            <h3 class="font-bold">Notifica√ß√µes</h3>
          </div>
          <div class="max-h-96 overflow-y-auto">
            <div class="p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
              <p class="text-sm font-semibold">Nova empresa cadastrada</p>
              <p class="text-xs text-gray-500 mt-1">Tech Solutions LTDA acabou de se cadastrar</p>
              <p class="text-xs text-gray-400 mt-1">5 minutos atr√°s</p>
            </div>
            <div class="p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
              <p class="text-sm font-semibold">Pagamento recebido</p>
              <p class="text-xs text-gray-500 mt-1">R$ 297,00 - Varejo Premium</p>
              <p class="text-xs text-gray-400 mt-1">1 hora atr√°s</p>
            </div>
            <div class="p-4 border-b border-gray-100 dark:border-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer">
              <p class="text-sm font-semibold">Inst√¢ncia desconectada</p>
              <p class="text-xs text-gray-500 mt-1">Startup XYZ - WhatsApp desconectado</p>
              <p class="text-xs text-gray-400 mt-1">2 horas atr√°s</p>
            </div>
          </div>
          <div class="p-3 border-t border-gray-200 dark:border-gray-700 text-center">
            <a href="/admin/notificacoes.html" class="text-sm text-purple-600 hover:text-purple-700 font-semibold">Ver todas</a>
          </div>
        </div>
      </div>

      <!-- Menu do Usu√°rio -->
      <div class="user-menu relative">
        <div class="flex items-center gap-2 cursor-pointer" onclick="toggleUserMenu()">
          <img src="https://ui-avatars.com/api/?name=Admin&background=5B21B6&color=fff" class="user-avatar" id="userAvatar">
          <div class="user-info hidden md:block">
            <div class="user-name" id="userName">Administrador</div>
            <div class="text-xs text-gray-500" id="userRole">Admin</div>
          </div>
          <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
          </svg>
        </div>

        <!-- Dropdown do Usu√°rio -->
        <div id="userDropdown" class="dropdown-menu" style="display: none; right: 0; left: auto;">
          <a href="/admin/perfil.html" class="dropdown-item">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
            </svg>
            <span>Meu Perfil</span>
          </a>
          <a href="/admin/configuracoes.html" class="dropdown-item">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
            </svg>
            <span>Configura√ß√µes</span>
          </a>
          <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
          <a href="#" onclick="logout(); return false;" class="dropdown-item text-red-600">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            <span>Sair</span>
          </a>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="app-main">
    <div class="mb-6">
      <h1 class="page-title">Painel Administrativo</h1>
      <p class="page-subtitle">Vis√£o geral da plataforma</p>
    </div>

    <!-- KPIs Globais -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-6 mb-6">
      <div class="card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 mb-1">Total Empresas</p>
            <h3 class="text-2xl font-bold" id="totalEmpresas">142</h3>
            <p class="text-xs text-green-600 mt-1">‚Üë 12 este m√™s</p>
          </div>
          <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 mb-1">Usu√°rios Ativos</p>
            <h3 class="text-2xl font-bold" id="totalUsuarios">1.238</h3>
            <p class="text-xs text-green-600 mt-1">‚Üë 8% vs m√™s anterior</p>
          </div>
          <div class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 mb-1">MRR Total</p>
            <h3 class="text-2xl font-bold text-green-600" id="totalMRR">R$ 42.180</h3>
            <p class="text-xs text-green-600 mt-1">‚Üë 15% vs m√™s anterior</p>
          </div>
          <div class="w-12 h-12 bg-green-100 dark:bg-green-900/30 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 mb-1">Msgs Enviadas</p>
            <h3 class="text-2xl font-bold" id="totalMensagens">458.230</h3>
            <p class="text-xs text-gray-500 mt-1">Este m√™s</p>
          </div>
          <div class="w-12 h-12 bg-yellow-100 dark:bg-yellow-900/30 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
            </svg>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="flex items-center justify-between">
          <div>
            <p class="text-sm text-gray-500 mb-1">Taxa Reten√ß√£o</p>
            <h3 class="text-2xl font-bold" id="taxaRetencao">94.3%</h3>
            <p class="text-xs text-green-600 mt-1">‚Üë 2.1% vs m√™s anterior</p>
          </div>
          <div class="w-12 h-12 bg-red-100 dark:bg-red-900/30 rounded-lg flex items-center justify-center">
            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Gr√°ficos -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <div class="card">
        <h3 class="font-bold mb-4">Receita Recorrente (MRR)</h3>
        <div style="height: 250px;">
          <canvas id="chartMRR"></canvas>
        </div>
      </div>

      <div class="card">
        <h3 class="font-bold mb-4">Novos Cadastros por Dia</h3>
        <div style="height: 250px;">
          <canvas id="chartCadastros"></canvas>
        </div>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
      <div class="card">
        <h3 class="font-bold mb-4">Distribui√ß√£o por Plano</h3>
        <div style="height: 250px;">
          <canvas id="chartPlanos"></canvas>
        </div>
      </div>

      <div class="card">
        <h3 class="font-bold mb-4">Churn Rate Mensal</h3>
        <div style="height: 250px;">
          <canvas id="chartChurn"></canvas>
        </div>
      </div>
    </div>

    <!-- Tabs -->
    <div class="tabs mb-6">
      <button class="tab active" onclick="showTab('empresas')">üè¢ Empresas</button>
      <button class="tab" onclick="showTab('usuarios')">üë• Usu√°rios</button>
      <button class="tab" onclick="showTab('financeiro')">üí∞ Financeiro</button>
      <button class="tab" onclick="showTab('afiliados')">ü§ù Afiliados</button>
      <button class="tab" onclick="showTab('sistema')">‚öôÔ∏è Sistema</button>
    </div>

    <!-- Empresas Tab -->
    <div id="tab-empresas">
      <div class="mb-4">
        <button class="btn btn-primary" onclick="window.location.href='/admin/empresas.html'">‚ûï Nova Empresa</button>
      </div>
      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>Empresa</th>
              <th>Plano</th>
              <th>Usu√°rios</th>
              <th>Inst√¢ncias</th>
              <th>Mensagens/m√™s</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="empresasTable">
            <tr>
              <td colspan="7" class="text-center py-8 text-gray-500">Carregando...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Usu√°rios Tab -->
    <div id="tab-usuarios" class="hidden">
      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>Nome</th>
              <th>Email</th>
              <th>Empresa</th>
              <th>Fun√ß√£o</th>
              <th>√öltimo Acesso</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="usuariosTable">
            <tr>
              <td colspan="7" class="text-center py-8 text-gray-500">Carregando...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Financeiro Tab -->
    <div id="tab-financeiro" class="hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">Receita Este M√™s</p>
          <h3 class="text-2xl font-bold text-green-600">R$ 42.180,00</h3>
        </div>
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">Receita Prevista</p>
          <h3 class="text-2xl font-bold text-blue-600">R$ 48.500,00</h3>
        </div>
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">Inadimpl√™ncia</p>
          <h3 class="text-2xl font-bold text-red-600">R$ 2.340,00</h3>
        </div>
      </div>
      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>Empresa</th>
              <th>Plano</th>
              <th>Valor</th>
              <th>Vencimento</th>
              <th>Status</th>
              <th>A√ß√µes</th>
            </tr>
          </thead>
          <tbody id="financeiroTable">
            <tr>
              <td colspan="6" class="text-center py-8 text-gray-500">Carregando...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Afiliados Tab -->
    <div id="tab-afiliados" class="hidden">
      <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">Total Afiliados</p>
          <h3 class="text-2xl font-bold">45</h3>
        </div>
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">Afiliados Ativos</p>
          <h3 class="text-2xl font-bold">32</h3>
        </div>
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">Comiss√µes Pagas</p>
          <h3 class="text-2xl font-bold text-green-600">R$ 12.450</h3>
        </div>
        <div class="card">
          <p class="text-sm text-gray-500 mb-1">A Pagar</p>
          <h3 class="text-2xl font-bold text-yellow-600">R$ 3.280</h3>
        </div>
      </div>
      <div class="card">
        <table class="table">
          <thead>
            <tr>
              <th>Afiliado</th>
              <th>Email</th>
              <th>Indica√ß√µes</th>
              <th>Assinantes Ativos</th>
              <th>Comiss√£o Total</th>
              <th>Status</th>
            </tr>
          </thead>
          <tbody id="afiliadosTable">
            <tr>
              <td colspan="6" class="text-center py-8 text-gray-500">Carregando...</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Sistema Tab -->
    <div id="tab-sistema" class="hidden">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="card">
          <h3 class="font-bold mb-3">Status do Servidor</h3>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm">CPU</span>
              <span class="font-semibold">45%</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
              <div class="bg-green-600 h-2 rounded-full" style="width: 45%"></div>
            </div>

            <div class="flex justify-between mt-2">
              <span class="text-sm">Mem√≥ria</span>
              <span class="font-semibold">62%</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
              <div class="bg-yellow-600 h-2 rounded-full" style="width: 62%"></div>
            </div>

            <div class="flex justify-between mt-2">
              <span class="text-sm">Disco</span>
              <span class="font-semibold">38%</span>
            </div>
            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
              <div class="bg-green-600 h-2 rounded-full" style="width: 38%"></div>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="font-bold mb-3">Servi√ßos</h3>
          <div class="space-y-2">
            <div class="flex items-center justify-between">
              <span class="text-sm">API Principal</span>
              <span class="badge badge-success">Online</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Redis Cache</span>
              <span class="badge badge-success">Online</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">PostgreSQL</span>
              <span class="badge badge-success">Online</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Socket.io</span>
              <span class="badge badge-success">Online</span>
            </div>
            <div class="flex items-center justify-between">
              <span class="text-sm">Bull Queue</span>
              <span class="badge badge-success">Online</span>
            </div>
          </div>
        </div>

        <div class="card">
          <h3 class="font-bold mb-3">Estat√≠sticas 24h</h3>
          <div class="space-y-2">
            <div class="flex justify-between">
              <span class="text-sm">Requisi√ß√µes</span>
              <span class="font-semibold">1.2M</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm">Tempo M√©dio</span>
              <span class="font-semibold">120ms</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm">Taxa de Erro</span>
              <span class="font-semibold text-green-600">0.02%</span>
            </div>
            <div class="flex justify-between">
              <span class="text-sm">Uptime</span>
              <span class="font-semibold text-green-600">99.98%</span>
            </div>
          </div>
        </div>
      </div>
    </div>

  </main>
</div>

<script src="/js/utils.js"></script>
<script>
// Verificar autentica√ß√£o
Auth.checkAuth();
const user = Auth.getUser();

if (user) {
  document.getElementById('userName').textContent = user.nome || 'Administrador';
  document.getElementById('userRole').textContent = user.funcao || 'Admin';

  // Atualizar avatar
  const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(user.nome || 'Admin')}&background=5B21B6&color=fff`;
  document.getElementById('userAvatar').src = avatarUrl;
}

// Toggle Sidebar
function toggleSidebar() {
  const sidebar = document.getElementById('sidebar');
  sidebar.classList.toggle('sidebar-collapsed');
}

// Toggle Dark Mode
function toggleDarkMode() {
  const html = document.documentElement;
  const isDark = html.classList.contains('dark');

  if (isDark) {
    html.classList.remove('dark');
    localStorage.setItem('darkMode', 'false');
  } else {
    html.classList.add('dark');
    localStorage.setItem('darkMode', 'true');
  }
}

// Carregar dark mode do localStorage
if (localStorage.getItem('darkMode') === 'true') {
  document.documentElement.classList.add('dark');
}

// Toggle Notifications
function toggleNotifications() {
  const dropdown = document.getElementById('notificationsDropdown');
  const userDropdown = document.getElementById('userDropdown');

  // Fechar dropdown do usu√°rio se estiver aberto
  if (userDropdown.style.display === 'block') {
    userDropdown.style.display = 'none';
  }

  dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
}

// Toggle User Menu
function toggleUserMenu() {
  const dropdown = document.getElementById('userDropdown');
  const notifDropdown = document.getElementById('notificationsDropdown');

  // Fechar dropdown de notifica√ß√µes se estiver aberto
  if (notifDropdown.style.display === 'block') {
    notifDropdown.style.display = 'none';
  }

  dropdown.style.display = dropdown.style.display === 'none' ? 'block' : 'none';
}

// Fechar dropdowns ao clicar fora
document.addEventListener('click', function(event) {
  const notifBtn = event.target.closest('.header-btn');
  const userMenu = event.target.closest('.user-menu');

  if (!notifBtn && !userMenu) {
    document.getElementById('notificationsDropdown').style.display = 'none';
    document.getElementById('userDropdown').style.display = 'none';
  }
});

// Logout
function logout() {
  if (confirm('Deseja realmente sair?')) {
    Auth.logout();
    window.location.href = '/login.html';
  }
}

// Renderizar Gr√°ficos
let chartMRR, chartCadastros, chartPlanos, chartChurn;

function renderChartMRR() {
  const ctx = document.getElementById('chartMRR');
  if (chartMRR) chartMRR.destroy();

  chartMRR = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
      datasets: [{
        label: 'MRR',
        borderColor: '#5B21B6',
        backgroundColor: 'rgba(91, 33, 182, 0.1)',
        data: [28500, 30200, 32100, 34500, 36200, 38100, 39800, 40200, 41500, 42180, null, null],
        tension: 0.4,
        fill: true
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      },
      scales: {
        y: {
          beginAtZero: false
        }
      }
    }
  });
}

function renderChartCadastros() {
  const ctx = document.getElementById('chartCadastros');
  if (chartCadastros) chartCadastros.destroy();

  chartCadastros = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['1', '5', '10', '15', '20', '25', '30'],
      datasets: [{
        label: 'Cadastros',
        backgroundColor: '#5B21B6',
        data: [8, 12, 15, 10, 18, 14, 12]
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      }
    }
  });
}

function renderChartPlanos() {
  const ctx = document.getElementById('chartPlanos');
  if (chartPlanos) chartPlanos.destroy();

  chartPlanos = new Chart(ctx, {
    type: 'doughnut',
    data: {
      labels: ['B√°sico', 'Premium', 'Enterprise'],
      datasets: [{
        data: [45, 82, 15],
        backgroundColor: ['#A78BFA', '#5B21B6', '#7C3AED']
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false
    }
  });
}

function renderChartChurn() {
  const ctx = document.getElementById('chartChurn');
  if (chartChurn) chartChurn.destroy();

  chartChurn = new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'],
      datasets: [{
        label: 'Churn %',
        borderColor: '#DC2626',
        backgroundColor: 'rgba(220, 38, 38, 0.1)',
        data: [8.2, 7.5, 6.8, 5.9, 5.2, 4.8, 5.1, 5.7, 6.2, 5.7, null, null],
        tension: 0.4
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          display: false
        }
      }
    }
  });
}

// Carregar dados das tabs
function loadEmpresas() {
  const empresas = [
    { nome: 'Tech Solutions LTDA', plano: 'Enterprise', usuarios: 20, instancias: 10, mensagens: 45200, status: 'ativa' },
    { nome: 'Varejo Premium', plano: 'Premium', usuarios: 5, instancias: 3, mensagens: 8500, status: 'ativa' },
    { nome: 'Startup XYZ', plano: 'B√°sico', usuarios: 2, instancias: 1, mensagens: 2800, status: 'trial' }
  ];

  document.getElementById('empresasTable').innerHTML = empresas.map(e => `
    <tr>
      <td class="font-semibold">${e.nome}</td>
      <td><span class="badge badge-secondary">${e.plano}</span></td>
      <td>${e.usuarios}</td>
      <td>${e.instancias}</td>
      <td>${e.mensagens.toLocaleString('pt-BR')}</td>
      <td><span class="badge badge-${e.status === 'ativa' ? 'success' : e.status === 'trial' ? 'warning' : 'error'}">${e.status.charAt(0).toUpperCase() + e.status.slice(1)}</span></td>
      <td><button class="btn-sm btn-outline">Ver</button></td>
    </tr>
  `).join('');
}

function loadUsuarios() {
  const usuarios = [
    { nome: 'Jo√£o Silva', email: 'joao@techsolutions.com', empresa: 'Tech Solutions LTDA', funcao: 'Administrador', ultimoAcesso: 'Agora', status: 'ativo' },
    { nome: 'Maria Santos', email: 'maria@varejo.com', empresa: 'Varejo Premium', funcao: 'Vendedor', ultimoAcesso: '5 min atr√°s', status: 'ativo' }
  ];

  document.getElementById('usuariosTable').innerHTML = usuarios.map(u => `
    <tr>
      <td class="font-semibold">${u.nome}</td>
      <td class="text-sm">${u.email}</td>
      <td>${u.empresa}</td>
      <td><span class="badge badge-secondary">${u.funcao}</span></td>
      <td class="text-sm">${u.ultimoAcesso}</td>
      <td><span class="badge badge-success">${u.status.charAt(0).toUpperCase() + u.status.slice(1)}</span></td>
      <td><button class="btn-sm btn-outline">Ver</button></td>
    </tr>
  `).join('');
}

function loadFinanceiro() {
  const financeiro = [
    { empresa: 'Tech Solutions LTDA', plano: 'Enterprise', valor: 797.00, vencimento: '10/01/2025', status: 'ativa' },
    { empresa: 'Varejo Premium', plano: 'Premium', valor: 297.00, vencimento: '15/01/2025', status: 'ativa' },
    { empresa: 'Startup ABC', plano: 'B√°sico', valor: 97.00, vencimento: '20/12/2024', status: 'atrasada' }
  ];

  document.getElementById('financeiroTable').innerHTML = financeiro.map(f => `
    <tr>
      <td class="font-semibold">${f.empresa}</td>
      <td><span class="badge badge-secondary">${f.plano}</span></td>
      <td class="font-bold">R$ ${f.valor.toFixed(2)}</td>
      <td class="text-sm">${f.vencimento}</td>
      <td><span class="badge badge-${f.status === 'ativa' ? 'success' : 'error'}">${f.status.charAt(0).toUpperCase() + f.status.slice(1)}</span></td>
      <td><button class="btn-sm btn-outline">Ver</button></td>
    </tr>
  `).join('');
}

function loadAfiliados() {
  const afiliados = [
    { nome: 'Carlos Souza', email: 'carlos@afiliado.com', indicacoes: 23, assinantes: 18, comissao: 3450.00, status: 'ativo' },
    { nome: 'Ana Lima', email: 'ana@afiliado.com', indicacoes: 15, assinantes: 12, comissao: 2180.00, status: 'ativo' }
  ];

  document.getElementById('afiliadosTable').innerHTML = afiliados.map(a => `
    <tr>
      <td class="font-semibold">${a.nome}</td>
      <td class="text-sm">${a.email}</td>
      <td>${a.indicacoes}</td>
      <td>${a.assinantes}</td>
      <td class="font-bold text-green-600">R$ ${a.comissao.toFixed(2)}</td>
      <td><span class="badge badge-success">${a.status.charAt(0).toUpperCase() + a.status.slice(1)}</span></td>
    </tr>
  `).join('');
}

// Mostrar tab
function showTab(name) {
  document.querySelectorAll('[id^="tab-"]').forEach(t => t.classList.add('hidden'));
  document.getElementById(`tab-${name}`).classList.remove('hidden');

  document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
  event.target.classList.add('active');

  if (name === 'usuarios') loadUsuarios();
  if (name === 'financeiro') loadFinanceiro();
  if (name === 'afiliados') loadAfiliados();
}

// Inicializar
setTimeout(() => {
  renderChartMRR();
  renderChartCadastros();
  renderChartPlanos();
  renderChartChurn();
  loadEmpresas();
}, 100);
</script>

</body>
</html>
