<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{TITLE}} - WhatsBenemax</title>
  <link rel="stylesheet" href="/css/app.css">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/heroicons@2.0.18/24/outline/index.css">
</head>
<body>

  <!-- Container Principal -->
  <div class="app-container">

    <!-- SIDEBAR -->
    <aside class="app-sidebar" id="sidebar">

      <!-- Logo -->
      <div class="sidebar-logo">
        <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path>
        </svg>
        <span>WhatsBenemax</span>
      </div>

      <!-- Menu -->
      <nav class="sidebar-menu" id="sidebarMenu">
        <!-- Menu será carregado dinamicamente baseado no tipo de usuário -->
      </nav>

    </aside>

    <!-- HEADER -->
    <header class="app-header" id="header">

      <!-- Toggle Sidebar (Mobile) -->
      <button onclick="Sidebar.toggle()" class="header-btn md:hidden">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
      </button>

      <!-- Busca Global -->
      <div class="header-search hidden md:block">
        <div class="relative">
          <svg class="w-5 h-5 absolute left-3 top-1/2 -translate-y-1/2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
          </svg>
          <input type="text" placeholder="Buscar... (Ctrl+K)" class="w-full pl-10" id="globalSearch">
        </div>
      </div>

      <!-- Header Actions -->
      <div class="header-actions">

        <!-- Notificações -->
        <div class="dropdown">
          <button class="header-btn" id="notificationBtn" onclick="toggleNotifications()">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path>
            </svg>
            <span class="badge with-count" id="notificationCount">0</span>
          </button>

          <!-- Dropdown Notificações -->
          <div id="notificationDropdown" class="dropdown-menu hidden" style="width: 350px;">
            <div class="flex items-center justify-between p-3 border-b border-gray-200 dark:border-gray-700">
              <h3 class="font-semibold">Notificações</h3>
              <button class="text-sm text-purple-600 hover:text-purple-700" onclick="markAllAsRead()">Marcar todas como lidas</button>
            </div>
            <div id="notificationList" class="max-h-96 overflow-y-auto">
              <!-- Notificações serão carregadas aqui -->
            </div>
            <div class="p-3 border-t border-gray-200 dark:border-gray-700 text-center">
              <a href="/notificacoes.html" class="text-sm text-purple-600 hover:text-purple-700 font-semibold">Ver todas</a>
            </div>
          </div>
        </div>

        <!-- Dark Mode Toggle -->
        <button class="header-btn" onclick="DarkMode.toggle()">
          <svg class="w-6 h-6 dark:hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
          </svg>
          <svg class="w-6 h-6 hidden dark:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path>
          </svg>
        </button>

        <!-- User Menu -->
        <div class="dropdown">
          <div class="user-menu" id="userMenuBtn" onclick="toggleUserMenu()">
            <img src="https://ui-avatars.com/api/?name=Usuario&background=5B21B6&color=fff" alt="Avatar" class="user-avatar" id="userAvatar">
            <div class="user-info hidden md:block">
              <div class="user-name" id="userName">Carregando...</div>
              <div class="user-role" id="userRole">...</div>
            </div>
            <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </div>

          <!-- Dropdown User Menu -->
          <div id="userMenuDropdown" class="dropdown-menu hidden">
            <a href="/configuracoes.html" class="dropdown-item">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              Meu Perfil
            </a>
            <a href="/configuracoes.html" class="dropdown-item">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
              </svg>
              Configurações
            </a>
            <div class="dropdown-divider"></div>
            <button onclick="logout()" class="dropdown-item text-red-600">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
              </svg>
              Sair
            </button>
          </div>
        </div>

      </div>

    </header>

    <!-- MAIN CONTENT -->
    <main class="app-main" id="main">
      {{CONTENT}}
    </main>

  </div>

  <!-- Scripts -->
  <script src="/js/utils.js"></script>
  <script>
    // Verificar autenticação
    if (!Auth.checkAuth()) {
      window.location.href = '/login.html';
    }

    // Carregar dados do usuário
    const user = Auth.getUser();
    if (user) {
      document.getElementById('userName').textContent = user.nome;
      document.getElementById('userRole').textContent = getRoleLabel(user.funcao);
      document.getElementById('userAvatar').src = user.avatar_url || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.nome)}&background=5B21B6&color=fff`;

      // Carregar menu baseado no tipo de usuário
      loadMenu(user.funcao);
    }

    function getRoleLabel(funcao) {
      const labels = {
        'administrador': 'Administrador',
        'afiliado': 'Afiliado',
        'empresa': 'Empresa',
        'usuario': 'Usuário',
      };
      return labels[funcao] || 'Usuário';
    }

    // Carregar menu dinâmico
    function loadMenu(funcao) {
      const menus = {
        empresa: [
          { icon: 'home', label: 'Dashboard', href: '/dashboard.html' },
          { icon: 'device-phone-mobile', label: 'Instâncias', href: '/instancias.html' },
          { icon: 'users', label: 'Contatos', href: '/contatos.html' },
          { icon: 'view-columns', label: 'CRM Kanban', href: '/crm.html' },
          { icon: 'arrow-path', label: 'Follow-up', href: '/followup.html' },
          { icon: 'cpu-chip', label: 'Agente IA', href: '/agente-ia.html' },
          { icon: 'megaphone', label: 'Prospecção', href: '/prospeccao.html' },
          { icon: 'chat-bubble-left-right', label: 'Chat', href: '/chat.html' },
          { icon: 'paint-brush', label: 'White Label', href: '/whitelabel.html' },
          { icon: 'user-group', label: 'Equipe', href: '/equipe.html' },
          { icon: 'chart-bar', label: 'Relatórios', href: '/relatorios.html' },
          { icon: 'puzzle-piece', label: 'Integrações', href: '/integracoes.html' },
          { icon: 'credit-card', label: 'Assinatura', href: '/assinatura.html' },
          { icon: 'cog-6-tooth', label: 'Configurações', href: '/configuracoes.html' },
        ],
        afiliado: [
          { icon: 'home', label: 'Dashboard', href: '/afiliado/dashboard.html' },
          { icon: 'link', label: 'Meu Link', href: '/afiliado/link.html' },
          { icon: 'users', label: 'Indicações', href: '/afiliado/indicacoes.html' },
          { icon: 'banknotes', label: 'Comissões', href: '/afiliado/comissoes.html' },
          { icon: 'building-library', label: 'Dados Bancários', href: '/afiliado/bancario.html' },
          { icon: 'chart-bar', label: 'Relatórios', href: '/afiliado/relatorios.html' },
          { icon: 'user', label: 'Meu Perfil', href: '/configuracoes.html' },
        ],
        administrador: [
          { icon: 'home', label: 'Dashboard', href: '/admin/dashboard.html' },
          { icon: 'building-office', label: 'Empresas', href: '/admin/empresas.html' },
          { icon: 'users', label: 'Usuários', href: '/admin/usuarios.html' },
          { icon: 'rectangle-stack', label: 'Planos', href: '/admin/planos.html' },
          { icon: 'user-group', label: 'Afiliados', href: '/admin/afiliados.html' },
          { icon: 'banknotes', label: 'Financeiro', href: '/admin/financeiro.html' },
          { icon: 'chart-bar', label: 'Relatórios', href: '/admin/relatorios.html' },
          { icon: 'cog-6-tooth', label: 'Sistema', href: '/admin/sistema.html' },
        ],
      };

      const menuItems = menus[funcao] || menus.empresa;
      const menuHtml = menuItems.map(item => `
        <a href="${item.href}" class="menu-item ${window.location.pathname === item.href ? 'active' : ''}">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            ${getIconPath(item.icon)}
          </svg>
          <span>${item.label}</span>
        </a>
      `).join('');

      document.getElementById('sidebarMenu').innerHTML = menuHtml;
    }

    function getIconPath(icon) {
      const icons = {
        'home': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"></path>',
        'device-phone-mobile': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.5 1.5H8.25A2.25 2.25 0 006 3.75v16.5a2.25 2.25 0 002.25 2.25h7.5A2.25 2.25 0 0018 20.25V3.75a2.25 2.25 0 00-2.25-2.25H13.5m-3 0V3h3V1.5m-3 0h3m-3 18.75h3"></path>',
        'users': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19.128a9.38 9.38 0 002.625.372 9.337 9.337 0 004.121-.952 4.125 4.125 0 00-7.533-2.493M15 19.128v-.003c0-1.113-.285-2.16-.786-3.07M15 19.128v.106A12.318 12.318 0 018.624 21c-2.331 0-4.512-.645-6.374-1.766l-.001-.109a6.375 6.375 0 0111.964-3.07M12 6.375a3.375 3.375 0 11-6.75 0 3.375 3.375 0 016.75 0zm8.25 2.25a2.625 2.625 0 11-5.25 0 2.625 2.625 0 015.25 0z"></path>',
        'view-columns': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 4.5v15m6-15v15m-10.875 0h15.75c.621 0 1.125-.504 1.125-1.125V5.625c0-.621-.504-1.125-1.125-1.125H4.125C3.504 4.5 3 5.004 3 5.625v12.75c0 .621.504 1.125 1.125 1.125z"></path>',
        'arrow-path': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0l3.181 3.183a8.25 8.25 0 0013.803-3.7M4.031 9.865a8.25 8.25 0 0113.803-3.7l3.181 3.182m0-4.991v4.99"></path>',
        'cpu-chip': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 002.25-2.25V6.75a2.25 2.25 0 00-2.25-2.25H6.75A2.25 2.25 0 004.5 6.75v10.5a2.25 2.25 0 002.25 2.25zm.75-12h9v9h-9v-9z"></path>',
        'megaphone': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.34 15.84c-.688-.06-1.386-.09-2.09-.09H7.5a4.5 4.5 0 110-9h.75c.704 0 1.402-.03 2.09-.09m0 9.18c.253.962.584 1.892.985 2.783.247.55.06 1.21-.463 1.511l-.657.38c-.551.318-1.26.117-1.527-.461a20.845 20.845 0 01-1.44-4.282m3.102.069a18.03 18.03 0 01-.59-4.59c0-1.586.205-3.124.59-4.59m0 9.18a23.848 23.848 0 018.835 2.535M10.34 6.66a23.847 23.847 0 008.835-2.535m0 0A23.74 23.74 0 0018.795 3m.38 1.125a23.91 23.91 0 011.014 5.395m-1.014 8.855c-.118.38-.245.754-.38 1.125m.38-1.125a23.91 23.91 0 001.014-5.395m0-3.46c.495.413.811 1.035.811 1.73 0 .695-.316 1.317-.811 1.73m0-3.46a24.347 24.347 0 010 3.46"></path>',
        'chat-bubble-left-right': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.25 8.511c.884.284 1.5 1.128 1.5 2.097v4.286c0 1.136-.847 2.1-1.98 2.193-.34.027-.68.052-1.02.072v3.091l-3-3c-1.354 0-2.694-.055-4.02-.163a2.115 2.115 0 01-.825-.242m9.345-8.334a2.126 2.126 0 00-.476-.095 48.64 48.64 0 00-8.048 0c-1.131.094-1.976 1.057-1.976 2.192v4.286c0 .837.46 1.58 1.155 1.951m9.345-8.334V6.637c0-1.621-1.152-3.026-2.76-3.235A48.455 48.455 0 0011.25 3c-2.115 0-4.198.137-6.24.402-1.608.209-2.76 1.614-2.76 3.235v6.226c0 1.621 1.152 3.026 2.76 3.235.577.075 1.157.14 1.74.194V21l4.155-4.155"></path>',
        'paint-brush': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.53 16.122a3 3 0 00-5.78 1.128 2.25 2.25 0 01-2.4 2.245 4.5 4.5 0 008.4-2.245c0-.399-.078-.78-.22-1.128zm0 0a15.998 15.998 0 003.388-1.62m-5.043-.025a15.994 15.994 0 011.622-3.395m3.42 3.42a15.995 15.995 0 004.764-4.648l3.876-5.814a1.151 1.151 0 00-1.597-1.597L14.146 6.32a15.996 15.996 0 00-4.649 4.763m3.42 3.42a6.776 6.776 0 00-3.42-3.42"></path>',
        'user-group': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 18.72a9.094 9.094 0 003.741-.479 3 3 0 00-4.682-2.72m.94 3.198l.001.031c0 .225-.012.447-.037.666A11.944 11.944 0 0112 21c-2.17 0-4.207-.576-5.963-1.584A6.062 6.062 0 016 18.719m12 0a5.971 5.971 0 00-.941-3.197m0 0A5.995 5.995 0 0012 12.75a5.995 5.995 0 00-5.058 2.772m0 0a3 3 0 00-4.681 2.72 8.986 8.986 0 003.74.477m.94-3.197a5.971 5.971 0 00-.94 3.197M15 6.75a3 3 0 11-6 0 3 3 0 016 0zm6 3a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0zm-13.5 0a2.25 2.25 0 11-4.5 0 2.25 2.25 0 014.5 0z"></path>',
        'chart-bar': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"></path>',
        'puzzle-piece': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.25 6.087c0-.355.186-.676.401-.959.221-.29.349-.634.349-1.003 0-1.036-1.007-1.875-2.25-1.875s-2.25.84-2.25 1.875c0 .369.128.713.349 1.003.215.283.401.604.401.959v0a.64.64 0 01-.657.643 48.39 48.39 0 01-4.163-.3c.186 1.613.293 3.25.315 4.907a.656.656 0 01-.658.663v0c-.355 0-.676-.186-.959-.401a1.647 1.647 0 00-1.003-.349c-1.036 0-1.875 1.007-1.875 2.25s.84 2.25 1.875 2.25c.369 0 .713-.128 1.003-.349.283-.215.604-.401.959-.401v0c.31 0 .555.26.532.57a48.039 48.039 0 01-.642 5.056c1.518.19 3.058.309 4.616.354a.64.64 0 00.657-.643v0c0-.355-.186-.676-.401-.959a1.647 1.647 0 01-.349-1.003c0-1.035 1.008-1.875 2.25-1.875 1.243 0 2.25.84 2.25 1.875 0 .369-.128.713-.349 1.003-.215.283-.4.604-.4.959v0c0 .333.277.599.61.58a48.1 48.1 0 005.427-.63 48.05 48.05 0 00.582-4.717.532.532 0 00-.533-.57v0c-.355 0-.676.186-.959.401-.29.221-.634.349-1.003.349-1.035 0-1.875-1.007-1.875-2.25s.84-2.25 1.875-2.25c.37 0 .713.128 1.003.349.283.215.604.401.96.401v0a.656.656 0 00.658-.663 48.422 48.422 0 00-.37-5.36c-1.886.342-3.81.574-5.766.689a.578.578 0 01-.61-.58v0z"></path>',
        'credit-card': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.25 8.25h19.5M2.25 9h19.5m-16.5 5.25h6m-6 2.25h3m-3.75 3h15a2.25 2.25 0 002.25-2.25V6.75A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25v10.5A2.25 2.25 0 004.5 19.5z"></path>',
        'cog-6-tooth': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>',
        'link': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.19 8.688a4.5 4.5 0 011.242 7.244l-4.5 4.5a4.5 4.5 0 01-6.364-6.364l1.757-1.757m13.35-.622l1.757-1.757a4.5 4.5 0 00-6.364-6.364l-4.5 4.5a4.5 4.5 0 001.242 7.244"></path>',
        'banknotes': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z"></path>',
        'building-library': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 21v-8.25M15.75 21v-8.25M8.25 21v-8.25M3 9l9-6 9 6m-1.5 12V10.332A48.36 48.36 0 0012 9.75c-2.551 0-5.056.2-7.5.582V21M3 21h18M12 6.75h.008v.008H12V6.75z"></path>',
        'user': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 20.118a7.5 7.5 0 0114.998 0A17.933 17.933 0 0112 21.75c-2.676 0-5.216-.584-7.499-1.632z"></path>',
        'building-office': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3.75 21h16.5M4.5 3h15M5.25 3v18m13.5-18v18M9 6.75h1.5m-1.5 3h1.5m-1.5 3h1.5m3-6H15m-1.5 3H15m-1.5 3H15M9 21v-3.375c0-.621.504-1.125 1.125-1.125h3.75c.621 0 1.125.504 1.125 1.125V21"></path>',
        'rectangle-stack': '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 6.878V6a2.25 2.25 0 012.25-2.25h7.5A2.25 2.25 0 0118 6v.878m-12 0c.235-.083.487-.128.75-.128h10.5c.263 0 .515.045.75.128m-12 0A2.25 2.25 0 004.5 9v.878m13.5-3A2.25 2.25 0 0119.5 9v.878m0 0a2.246 2.246 0 00-.75-.128H5.25c-.263 0-.515.045-.75.128m15 0A2.25 2.25 0 0121 12v6a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 18v-6c0-.98.626-1.813 1.5-2.122"></path>',
      };
      return icons[icon] || '';
    }

    // Dropdowns
    let notificationDropdownOpen = false;
    let userMenuDropdownOpen = false;

    function toggleNotifications() {
      notificationDropdownOpen = !notificationDropdownOpen;
      document.getElementById('notificationDropdown').classList.toggle('hidden', !notificationDropdownOpen);
      if (notificationDropdownOpen) {
        userMenuDropdownOpen = false;
        document.getElementById('userMenuDropdown').classList.add('hidden');
        loadNotifications();
      }
    }

    function toggleUserMenu() {
      userMenuDropdownOpen = !userMenuDropdownOpen;
      document.getElementById('userMenuDropdown').classList.toggle('hidden', !userMenuDropdownOpen);
      if (userMenuDropdownOpen) {
        notificationDropdownOpen = false;
        document.getElementById('notificationDropdown').classList.add('hidden');
      }
    }

    // Fechar dropdowns ao clicar fora
    document.addEventListener('click', (e) => {
      const notificationBtn = document.getElementById('notificationBtn');
      const notificationDropdown = document.getElementById('notificationDropdown');
      const userMenuBtn = document.getElementById('userMenuBtn');
      const userMenuDropdown = document.getElementById('userMenuDropdown');

      if (!notificationBtn.contains(e.target) && !notificationDropdown.contains(e.target)) {
        notificationDropdownOpen = false;
        notificationDropdown.classList.add('hidden');
      }

      if (!userMenuBtn.contains(e.target) && !userMenuDropdown.contains(e.target)) {
        userMenuDropdownOpen = false;
        userMenuDropdown.classList.add('hidden');
      }
    });

    // Carregar notificações
    async function loadNotifications() {
      try {
        const notifications = await API.get('/api/notificacoes?limit=5');
        const count = notifications.filter(n => !n.lida).length;

        document.getElementById('notificationCount').textContent = count;
        document.getElementById('notificationCount').classList.toggle('hidden', count === 0);

        const listHtml = notifications.length > 0 ? notifications.map(n => `
          <div class="p-3 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer border-b border-gray-100 dark:border-gray-700 ${!n.lida ? 'bg-purple-50 dark:bg-purple-900' : ''}">
            <div class="flex items-start gap-3">
              <div class="mt-1">${getNotificationIcon(n.tipo)}</div>
              <div class="flex-1">
                <h4 class="text-sm font-semibold text-gray-900 dark:text-white">${n.titulo}</h4>
                <p class="text-xs text-gray-600 dark:text-gray-400 mt-1">${n.mensagem}</p>
                <p class="text-xs text-gray-500 mt-1">${Format.relativeTime(n.criado_em)}</p>
              </div>
            </div>
          </div>
        `).join('') : '<div class="p-4 text-center text-gray-500">Nenhuma notificação</div>';

        document.getElementById('notificationList').innerHTML = listHtml;
      } catch (error) {
        console.error('Erro ao carregar notificações:', error);
      }
    }

    function getNotificationIcon(tipo) {
      const icons = {
        'mensagem': '<svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"></path></svg>',
        'credito': '<svg class="w-5 h-5 text-yellow-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path></svg>',
        'pagamento': '<svg class="w-5 h-5 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>',
      };
      return icons[tipo] || icons.mensagem;
    }

    async function markAllAsRead() {
      try {
        await API.post('/api/notificacoes/marcar-todas-lidas');
        loadNotifications();
        Toast.success('Notificações marcadas como lidas');
      } catch (error) {
        Toast.error('Erro ao marcar notificações');
      }
    }

    function logout() {
      Auth.logout();
    }

    // Busca global
    document.getElementById('globalSearch')?.addEventListener('input', debounce((e) => {
      const query = e.target.value;
      if (query.length >= 3) {
        // Implementar busca global
        console.log('Buscar:', query);
      }
    }, 500));
  </script>

</body>
</html>
